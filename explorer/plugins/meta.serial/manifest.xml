<?xml version="1.0" encoding="UTF-8"?>
<meta id="meta.serial" className="SerialMetaManager">
	<class_definition filename="plugins/meta.serial/class.SerialMetaManager.php" classname="SerialMetaManager"/>
	<client_settings icon="plugins/access.mysql/resources/images/mysql_icon.png">
		<resources>
			<i18n namespace="meta.serial" path="plugins/meta.serial/i18n" />
			<js file="plugins/meta.serial/class.MetaCellRenderer.js" className="MetaCellRenderer" autoload="true"/>		
		</resources>
	</client_settings>	
	<server_settings>
		<param name="meta_file_name" type="string" label="Meta File" description="Hidden file used inside folders to save meta data" mandatory="true" default=".ajxp_meta"/>
		<param name="meta_fields" type="string" label="Meta Fields" description="Comma separated list of fields, use standard characters here." mandatory="true" default="comment_field"/>
		<param name="meta_labels" type="string" label="Meta Labels" description="Comma separated list of labels, be sure to define as many as fields!" mandatory="true" default="My Comments"/>
	</server_settings>	
	<registry_contributions>
		<hooks>
			<serverCallback hookName="ls.metadata" methodName="extractMeta"></serverCallback>
			<serverCallback hookName="move.metadata" methodName="updateMetaLocation"></serverCallback>
		</hooks>
		<client_configs>
			<template_part ajxpId="search_container" ajxpClass="SearchEngine" ajxpOptions="{}"/>
			<component_config className="FilesList">
				<columns><!-- Dynamically generated by the plugin  --></columns>
			</component_config>
			<component_config className="InfoPanel">			
				<infoPanelExtension mime="generic_file,generic_dir" attributes="">		
					<html></html>
				</infoPanelExtension>
			</component_config>			
		</client_configs>
		<actions>
			<action name="edit_serial_meta">
				<gui text="meta.serial.1" title="meta.serial.1" src="documentinfo_koffice.png" hasAccessKey="false">
					<context selection="true" dir="" recycle="hidden"
						actionBar="false" contextMenu="true" infoPanel="false"
						actionBarGroup="put" inZip="false">
					</context>
					<selectionContext dir="true" file="file" recycle="false" unique="true"></selectionContext>
					</gui>
				<rightsContext noUser="true" userLogged="only" read="true" write="true" adminOnly=""></rightsContext>
				<processing>
					<clientCallback prepareModal="true"><![CDATA[
						var userSelection = ajaxplorer.getUserSelection();
						var loadFunc = function(oForm){
							var form = $(oForm).select('div[id="serial_meta_form"]')[0];
							var nodeMeta = userSelection.getUniqueNode().getMetadata();
							var metaFields = nodeMeta.get('meta_fields').split(',');
							var metaLabels = nodeMeta.get('meta_labels').split(',');
							for(var i=0;i<metaFields.length;i++){
								var value = nodeMeta.get(metaFields[i]) || '';
								form.insert('<div class="SF_element"><div class="SF_label">'+metaLabels[i]+' : </div><input class="SF_input" name="'+metaFields[i]+'" value="'+value+'"/></div>');
								if(metaFields[i] == 'stars_rate'){
									var element = form.down('input[name="stars_rate"]');
									MetaCellRenderer.prototype.formPanelStars(element, form);
								}else if(metaFields[i] == 'css_label'){
									var element = form.down('input[name="css_label"]');
									MetaCellRenderer.prototype.formPanelCssLabels(element, form);
								}
							}
						}
						var closeFunc = function(){
							var oForm = $(modal.getForm());
							userSelection.updateFormOrUrl(modal.getForm());	
							ajaxplorer.actionBar.submitForm(oForm);				
							hideLightBox(true);
							return false;
						};
						modal.showDialogForm('Meta Edit', 'serial_meta_form', loadFunc, closeFunc);
						]]></clientCallback>
					<clientForm id="serial_meta_form"><![CDATA[
					<div id="serial_meta_form" action="edit_serial_meta" box_width="250"></div>
					]]></clientForm>
					<serverCallback methodName="editMeta"></serverCallback>
					</processing>
			</action>			
		</actions>
	</registry_contributions>
	<dependencies>
		<!-- Wrapper type plugins only -->
		<pluginClass pluginName="access.fs|access.ftp|access.demo|access.remote_fs"/>
	</dependencies>				
</meta>